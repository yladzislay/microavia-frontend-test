# Анализ Функциональности Системы

## 1. Существующая Функциональность (Изначально в Проекте)

На основе анализа исходного кода проекта, предоставленного в качестве тестового задания, можно выделить следующую уже реализованную функциональность:

### 1.1. Визуализация 3D Глобуса:
-   **Инициализация глобуса**: Проект инициализирует 3D-глобус с использованием библиотеки `@openglobus/og`.
    -   Задается целевой HTML-элемент (`"app"`).
    -   Настраивается источник данных для рельефа (`GlobusRgbTerrain`).
    -   Подключаются базовые картографические слои: OpenStreetMap (`osm`) и спутниковый слой Bing (`sat`).
    -   Указаны пути к ресурсам и шрифтам библиотеки OpenGlobus.
-   **Инструменты управления**:
    -   На глобус добавлен контрол `RulerSwitcher` (инструмент "линейка"), позволяющий измерять расстояния на карте.

### 1.2. Отображение Полигонов:
-   **Загрузка полигонов**: Полигоны загружаются из файла `src/polygons/polygons.json`.
    -   Данные в формате GeoJSON парсятся и преобразуются в геометрии, понятные OpenGlobus (с помощью утилит в `src/polygons/utils.ts`).
    -   Создается специальный векторный слой (`POLYGONS_LAYER`) для отображения этих полигонов.
    -   Каждый полигон представляется экземпляром кастомного класса `Polygon` (наследник `Entity` из OpenGlobus).
-   **Навигация**: При загрузке сцены камера автоматически перемещается к экстенту последнего загруженного полигона.

### 1.3. Слой для Отображения Линий:
-   **Инициализация слоя**: Создан пустой векторный слой (`LINE_LAYER`) для последующего отображения генерируемых линий.
-   **Представление линии**: Определен класс `Line` (наследник `Entity`) для представления одного линейного сегмента на карте, который создается по двум точкам (начальная и конечная). Линии имеют предопределенный стиль (красный цвет, толщина 10px).

### 1.4. Базовая Интерактивность:
-   **Обработка двойного клика**: На слое полигонов (`POLYGONS_LAYER`) установлен обработчик события двойного клика левой кнопкой мыши.
    -   При двойном клике на полигоне:
        -   Извлекаются координаты кликнутого полигона (`polygon.coordinates`).
        -   Слой линий (`LINE_LAYER`) очищается от ранее отрисованных линий.
        -   Вызывается функция-заглушка `createParallelHatching(coordinates)`, которой передаются координаты полигона. На данный момент эта функция возвращает пустой массив и не принимает параметры `step`, `bearing`, `offset` извне (использует значения по умолчанию).
        -   Предусмотрен (но пока не используется из-за пустого результата `createParallelHatching`) механизм добавления возвращенных линий на `LINE_LAYER`.

### 1.5. Структура Проекта:
-   Проект имеет модульную структуру с разделением логики по файлам и директориям (`globus.ts`, `main.ts`, `lines/`, `polygons/`).
-   Используется TypeScript.
-   Настроен для запуска с помощью `npm run dev` (Vite).

## 2. Требуемая Функциональность (в Рамках Задания)

Основная задача — реализовать алгоритм генерации параллельных линий (штриховки) для выбранного полигона.

### 2.1. Реализация Алгоритма `createParallelHatching`:
-   **Входные параметры**: Функция должна принимать:
    -   `coordinates`: Координаты одного полигона (внешний контур) в формате `[number, number, number?][][]` (из которых будет использоваться `coordinates[0]`).
    -   `step` (по умолчанию 100м): Расстояние между соседними параллельными линиями.
    -   `bearing` (по умолчанию 0 градусов): Ориентация линий (азимут от Севера).
    -   `offset` (по умолчанию 50м): Внешний отступ линий от края полигона.
-   **Выходные данные**: Функция должна возвращать массив линий `LonLat[][]`. Каждая линия в этом массиве — это пара объектов `LonLat`, представляющих начальную и конечную точки одного прямолинейного сегмента.
-   **Логика алгоритма**:
    -   Генерация набора параллельных линий, покрывающих всю площадь выбранного полигона.
    -   Линии должны быть ориентированы согласно параметру `bearing`.
    -   Расстояние между осевыми линиями должно соответствовать параметру `step`.
    -   Каждая линия должна начинаться и заканчиваться на расстоянии `offset` за пределами границ полигона.
-   **Место реализации**: `src/lines/parallelHatchingAlgorithm.ts`.

### 2.2. Корректное Отображение Сгенерированных Линий:
-   После вызова `createParallelHatching` в `main.ts`, полученные линии должны быть корректно добавлены на `LINE_LAYER` и отображены на глобусе.
-   Визуальный результат должен соответствовать примеру в предоставленном видео.

### 2.3. Динамическое Обновление (Опционально, но влияет на тестирование параметров):
-   Хотя явное требование UI для изменения `step`, `bearing`, `offset` является опциональным, текущая реализация в `main.ts` вызывает `createParallelHatching` только с координатами, что означает использование значений по умолчанию для остальных параметров.
-   Для полноценного тестирования и демонстрации работы алгоритма с разными параметрами, необходимо будет либо временно модифицировать `main.ts` для передачи разных значений, либо реализовать UI-виджет (см. п. 2.5).

### 2.4. Производительность:
-   Алгоритм должен быть достаточно производительным для эффективной обработки больших полигонов.

### 2.5. Опциональная Функциональность (UI-виджет):
-   **Реализация UI-виджета**: Добавить небольшой пользовательский интерфейс для динамической настройки параметров:
    -   Расстояние между линиями (`step`).
    -   Ориентация линий (`bearing`).
    -   Отступ (`offset`).
-   **Интерактивность**: Изменение этих параметров в UI должно приводить к немедленному обновлению (перерисовке) параллельных линий на карте для текущего выбранного полигона.

### 2.6. Валидация и Соответствие:
-   **Визуальная проверка**: Использование инструмента "линейка" для проверки корректности шага, отступов и ориентации.
-   **Соответствие видео**: Результат должен быть визуально идентичен поведению, показанному в эталонном видео.
-   **Прямолинейность и Ограничение**: Линии должны быть прямыми и корректно ограничены полигоном с учетом отступа.

## 3. Потенциальная Будущая Функциональность (После Реализации Основных Требований)

*(Этот раздел будет заполнен позже, после выполнения основных требований и возможного мозгового штурма.)*
-   [ ] ...
```